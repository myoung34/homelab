apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
metadata:
  name: argocd

resources:
 - namespace.yaml
 - vault.yaml
 - argocd.yaml
 - appset.yaml
 - sa-wf.yaml
 - tailscale.yaml
 - tailscale-wf.yaml
patches:
 - path: configmap.yaml

helmCharts:
- name: argo-cd
  releaseName: argocd
  namespace: argocd
  version: 6.6.0
  includeCRDs: true
  repo: https://argoproj.github.io/argo-helm
  valuesInline:
    global:
      deploymentAnnotations:
        configmap.reloader.stakater.com/reload: "argocd-cm,argocd-rbac-cm"
    repoServer:
      metrics:
        enabled: true
    applicationSet:
      webhook:
        ingress:
          enabled: false
      metrics:
        enabled: true
    notifications:
      metrics:
        enabled: true
    controller:
      metrics:
        enabled: true
    server:
      metrics:
        enabled: true
      extraArgs:
        - --insecure
- name: argo-workflows
  releaseName: argocd-workflows
  namespace: argocd
  version: 0.40.14
  includeCRDs: true
  repo: https://argoproj.github.io/argo-helm
  valuesInline:
    controller:
      metrics:
        enabled: true
      logging:
        level: debug
      workflowNamespaces:
        - argocd
    server:
      metrics:
        enabled: true
      logging:
        level: debug
      extraArgs:
        - --insecure-skip-verify=true
    workflow:
      logging:
        level: debug
      serviceAccount:
        create: true
        labels: {}
        name: "admin-user"
